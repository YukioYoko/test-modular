generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Usuario {
  id             Int       @id @default(autoincrement())
  usuario        String    @unique
  email          String    @unique
  password       String
  rol            String
  fecha_creacion DateTime? @default(now())

  @@map("Usuario")
}

model Mesero {
  id_mesero Int        @id @default(autoincrement())
  nombre    String
  turno     String
  comandas  Comandas[]

  @@map("meseros")
}

model Mesa {
  id_mesa       Int        @id @default(autoincrement())
  numero_mesa   Int        @unique
  capacidad     Int        @default(1)
  estado        String     @default("Libre")
  junta_id_mesa Int?
  comandas      Comandas[]

  @@map("mesas")
}

model Producto {
  id_producto Int                   @id @default(autoincrement())
  nombre      String
  precio      Decimal               @default(0.0) @db.Decimal(10, 2)
  categoria   String
  descripcion String?
  tiempo_prep Int                   @default(0)
  pasos       String?
  eliminado   Boolean               @default(false)
  activo      Boolean               @default(false)
  detalles    DetalleComanda[]
  aditamentos ProductoAditamentos[]
  imagen      ProductoImagen[]

  @@map("productos")
}

model Aditamento {
  id_aditamento Int                   @id @default(autoincrement())
  nombre        String
  precio        Float                 @default(0.0)
  comandas      ComandaAditamentos[]
  productos     ProductoAditamentos[]

  @@map("aditamentos")
}

model ProductoAditamentos {
  id_producto   Int
  id_aditamento Int
  aditamento    Aditamento @relation(fields: [id_aditamento], references: [id_aditamento], onDelete: Cascade, onUpdate: NoAction)
  producto      Producto   @relation(fields: [id_producto], references: [id_producto], onDelete: Cascade, onUpdate: NoAction)

  @@id([id_producto, id_aditamento])
  @@map("producto_aditamentos")
}

model Comandas {
  id_comanda     Int              @id @default(autoincrement())
  id_mesa        Int
  id_mesero      Int
  fecha_hora     DateTime?        @default(now())
  estado         String           @default("Abierta")
  token          String?
  fecha_pagado   DateTime?
  impuestos      Float            @default(0.0)
  pagado         Boolean          @default(false)
  sub_total      Float            @default(0.0)
  total          Float            @default(0.0)
  transaccion_id String?
  metodo_pago    String?        
  
  mesa           Mesa             @relation(fields: [id_mesa], references: [id_mesa], onDelete: NoAction, onUpdate: NoAction)
  mesero         Mesero           @relation(fields: [id_mesero], references: [id_mesero], onDelete: NoAction, onUpdate: NoAction)
  detalles       DetalleComanda[]

  @@map("comandas")
}

model DetalleComanda {
  id_detalle       Int                  @id @default(autoincrement())
  id_comanda       Int
  id_producto      Int
  cantidad         Int                  @default(1)
  notas_especiales String?              @default("")
  status           String               @default("En espera")
  aditamentos      ComandaAditamentos[]
  comanda          Comandas             @relation(fields: [id_comanda], references: [id_comanda], onDelete: NoAction, onUpdate: NoAction)
  producto         Producto             @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)

  @@map("detalle_comanda")
}

model ComandaAditamentos {
  id_detalle    Int
  id_aditamento Int
  confirmacion  Boolean        @default(false)
  aditamento    Aditamento     @relation(fields: [id_aditamento], references: [id_aditamento], onDelete: NoAction, onUpdate: NoAction)
  detalle       DetalleComanda @relation(fields: [id_detalle], references: [id_detalle], onDelete: NoAction, onUpdate: NoAction)

  @@id([id_detalle, id_aditamento])
  @@map("comanda_aditamentos")
}

model ProductoImagen {
  id_imagen   Int      @id @default(autoincrement())
  url         String
  id_producto Int
  producto    Producto @relation(fields: [id_producto], references: [id_producto], onDelete: Cascade)

  @@map("producto_imagen")
}
